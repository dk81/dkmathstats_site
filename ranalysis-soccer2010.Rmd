---
title: "Analyzing Soccer Data From The 2010 World Cup In R and the dplyr Package"
output: html_document
---

&nbsp;

Hello. In this guide, I will show how R and the dplyr package can be used to extract soccer data. This guide has been a result of me playing around with R and its dplyr data manipulation package.

Code and output in R is provided.

&nbsp;

### <u>Topics</u>

&nbsp;

* The Worldcup Data
* Finding Data Using R's dplyr Package
* Subsetting The Data
* Selecting Data With Subsetted Data
* Notes

&nbsp;

### <u>The Worldcup Data</u>

&nbsp;

I found the world cup dataset from the faraway library in R. The dataset is listed as the variable worldcup. Shots, Passes, Tackles and Saves are counts. It is unknown why the dataset does not include goals scored for a player. We work with what we have here.

The documentation can be found with ``??worldcup`` after doing `library(faraway)`.

The variable Team is the Country in the tournament. Position choices are either Midfielder, Forward, Defender or Goalkeeper. The variable Time is in minutes played for the tournament.

You can install the dplyr package and the faraway library package with the code:

&nbsp;

```
install.packages("dplyr")

install.packages("faraway")
```

&nbsp;

After installation, we load the data and take a look at the data as follows:

&nbsp;

```{r}
# Analyzing worldcup data from 2010 World Cup using dplyr:

# faraway package:

library(faraway)
library(dplyr)
```

&nbsp;

We then save the worldcup dataset into a variable called `wc_2010` and take a look at the data using the `head()` and `str()` functions in R.

&nbsp;

```{r}
# Worldcup data documentation:
# http://www.rdocumentation.org/packages/faraway/versions/1.0.7/topics/worldcup

wc_2010 <- data.frame(worldcup)

head(wc_2010)

str(wc_2010)
```

&nbsp;


Notice how each entry in each row starts with the player's last name and not with an index number. The player name is not a part of the dataset. These player names are in the row names of the dataset.

The following code will convert the players names as row names into player names in a column.

&nbsp;

```{r}
# Add Names to data.frame:

player_names <- row.names(wc_2010)

wc_2010 <- data.frame(Player = player_names, wc_2010)

head(wc_2010)
```

&nbsp;

Each row is indexed by the player's last name but that looks weird. They will be replaced by indices 1, 2, 3 and so on.

&nbsp;

```{r}
# Instead of having the names in each row, just have 1, 2, 3, ...
row.names(wc_2010) <- NULL

head(wc_2010)

```

&nbsp;

<u>Finding Data Using R's dplyr Package</u>

&nbsp;

The neat thing about R's `dplyr` is that you can easily find information from a data.frame. The dplyr package is very similar to SQL.

---

The following code can extract the players in this world cup (2 ways).

&nbsp;

```{r}
# Select Players:

players <- select(wc_2010, Player)
head(players, n = 15)

players <- wc_2010 %>% select(Player)
head(players, n = 15)
```

&nbsp;

The `head()` function shows a subset of the full dataset. The `n = 15` argument was used to show the first 15 rows of the dataset / vector.

&nbsp;

---

&nbsp;

**<u>The %>% Pipe Operator</u>**

&nbsp;

As you have noticed in the above, the two lines of code gives the same output. When the pipe operator %>% is used, the object in front of %>% is used as the first argument in the function after %>%.

Instead of `select(wc_2010, Player)`, we use `wc_2010 %>% select(Player)`. The pipe operator is used from here on out.

As another example, instead of having `f(x, y)` I could use `x %>% f(y)`.

---

We can find out the 32 teams in the 2010 World Cup:

&nbsp;

```{r}
# The teams / countries in this World Cup:

countries <- wc_2010 %>% select(Team) %>% distinct()
countries
```

&nbsp;

When we select from a column, it is possible to have duplicate rows. (In this case, we have multiple players from the same team.) The `%>% distinct()` part was used after `select()` to remove duplicates.

&nbsp;

---

&nbsp;

Suppose we wanted to select players with a playing time of at least 45 minutes. Also, we want to know how many played at leat 45 minutes at the tournament. The code is as follows:

&nbsp;

```{r}
## Select players with playing time at least 45 minutes:

head(wc_2010 %>% filter(Time >= 45)) #Gives us the list

wc_2010 %>% filter(Time >= 45) %>% summarise(Count = n()) #Gives the counts.
```


&nbsp;

The `select()` command deals with selecting from columns while the `filter()` command in dplyr extracts rows/observations which meet a criteria.

To get players who played at least 45 minutes, we use `Time >= 45` as the criteria.

To give counts, the `summarise(Count = n())` gives the counts.

&nbsp;

---

&nbsp;

Here are the top 10 players with the most playing time.

&nbsp;


```{r}
## Top 10 Players with the highest playing time (in minutes) of WC2010:

wc_2010 %>% 
  select(Player, Team, Position, Time) %>%
  top_n(10, Time) %>% 
  arrange(desc(Time))


```

&nbsp;


The `top_n()` function is used after `select()`. This `top_n()` function selects and orders the top n entries given a column. The user specifies the n value which is 10 in this case.

The `arrange()` function is used last. It is used to order rows by values in a column. By default, it arranges from low to high. To arrange from high to low, the `desc()` part is needed.

&nbsp;

---

&nbsp;

Here is the average playing time for a player at the tournament.

&nbsp;

```{r}
# Average Playing Time in Minutes For A Player:

wc_2010 %>% summarise(Average_Playing_Time = round(mean(Time),0))
```

&nbsp;

**Subsetting the Data**

&nbsp;

The `filter()` function in dplyr can be used to create smaller datasets which are a subset of the original dataset.

We can create smaller datasets which is just for midfielders, one for forwards (strikers), one for defenders and for goalkeepers.

&nbsp;

```{r}
# We can separate the data to midfielders, forwards, defenders and goalkeepers.

# Midfielders:
  
midfielder <- wc_2010 %>% filter(Position == "Midfielder")
head(midfielder)

#Number of Midfielders
nrow(midfielder)

# Forwards:

forward <- wc_2010 %>% filter(Position == "Forward")
head(forward)

#Number of Forwards
nrow(forward)

# Defenders:

defenders <- wc_2010 %>% filter(Position == "Defender")
head(defenders)

#Number of Defenders
nrow(defenders)

# Goalkeepers:

keepers <- wc_2010 %>% filter(Position == "Goalkeeper")
head(keepers)

#Number of Goalkeepers:
nrow(keepers)
```

&nbsp;

**Selecting Data With Subsetted Data**

&nbsp;

Here are the French forwards of the 2010 World Cup.

&nbsp;

```{r}
## Select forwards from France:

forward %>% filter(Team == "France")
```

&nbsp;

---

&nbsp;

Here are the forwards from the countries Spain, England, Germany and Italy.

&nbsp;

```{r}
# Forwards from Countries Spain, Germany, England, Italy:

forward %>% 
  filter(Team %in% c("Spain", "Germany", "England", "Italy")) %>% 
  select(Player, Team) %>% 
  arrange(Team)
```

&nbsp;

---

**Top 10 Goalkeepers With The Most Saves**

&nbsp;

```{r}
## Goalkeepers with the most saves of WC2010:

keepers %>% 
  select(Player, Team, Time, Saves) %>%
  top_n(10, Saves) %>% 
  arrange(desc(Saves))
```

&nbsp;

---

**Top 10 Forwards With The Most Attempted Shots**

&nbsp;

```{r}
## Forwards with the most shots attempted (Top 10):

forward %>% 
  select(Player, Team, Shots) %>% 
  top_n(10, Shots) %>% 
  arrange(desc(Shots))
```

---

**Top 10 Midfielders With The Most Passes**

&nbsp;

```{r}
## Midfielders With The Most Passes (Top 10):

midfielder %>% 
  select(Player, Team, Passes) %>%
  top_n(10, Passes) %>% 
  arrange(desc(Passes))
```

&nbsp;

---

**Top 10 Defenders With The Most Tackles**

```{r}
## Top 10 Defenders with the most amount of tackles:

defenders %>% 
  select(Player, Team, Tackles) %>%
  top_n(10, Tackles) %>% 
  arrange(desc(Tackles))
```

&nbsp;

### <u>Notes</u>

&nbsp;

Top ten lists can have ties.

The `dplyr` package in R is very useful in extracting information from datasets.

As mentioned before, it is disappointing that there is no information about goals in the worldcup dataset in the faraway library.

&nbsp;

### <u>References</u>

&nbsp;

R Documentation of worldcup dataset: http://www.rdocumentation.org/packages/faraway/versions/1.0.7/topics/worldcup

Data Wrangling with dplyr and tidyr Cheat Sheet:

https://www.rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf

The featured image is from https://upload.wikimedia.org/wikipedia/en/thumb/2/21/2010_FIFA_World_Cup_logo.svg/932px-2010_FIFA_World_Cup_logo.svg.png.