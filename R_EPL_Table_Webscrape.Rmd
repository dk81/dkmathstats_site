---
title: "English Premier League Table Webscrape"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

With this webscraping project in R, I webscrape the English Premier League football table. The setup below features loading the necessary libraries and using `read_html()` to load in the Premier League table page.

&nbsp;

**Setup**

```{r, warning=FALSE, message = FALSE}
# English Premier League Football League Table
# Load libraries:

library(dplyr)
library(tidyr)
library(rvest)
library(stringr)
library(writexl)

## Extract English Premier League Soccer League tables page.

page <- read_html("https://www.premierleague.com/tables")

```

&nbsp;

## Extract Table Components

For extracting the parts of the table, I use a combination of `html_nodes()` and xpaths. This is used for the ranks, names, number of matches played, wins, draws, losses, goals for, goals against, goals difference and league points.

I had to use filtering such as `played <- played[1:20]` as using `html_nodes()` extracts more than it should. 

**Rank**

```{r}
# Rank:
rank <- page %>%
        html_nodes(xpath='//*[@class="tableContainer"]/div/table/tbody/tr/td[2]/span[1]') %>%
        html_text2() %>%
        readr::parse_integer()

```

&nbsp;

**Team Name In Premier League**

```{r}
# EPL Club Name:
name <- page %>%
        html_nodes(xpath='//*[@class="tableContainer"]/div/table/tbody/tr/td[3]/a/span[2]') %>%
        html_text2()
```

&nbsp;

**Matches Played**

```{r}
# Played Matches Amount, only take 20 as there are 20 teams
played <- page %>%
          html_nodes(xpath='//*[@class="tableContainer"]/div/table/tbody/tr/td[4]') %>%
          html_text2() %>%
          readr::parse_integer()
played <- played[1:20]

```

&nbsp;

**Wins**

```{r}
# Won
wins <- page %>%
        html_nodes(xpath='//*[@class="tableContainer"]/div/table/tbody/tr/td[5]') %>%
        html_text2() %>%
        readr::parse_integer()
wins <- wins[1:20]
```

&nbsp;

**Draws**

```{r}
# Draws
draws <- page %>%
         html_nodes(xpath='//*[@class="tableContainer"]/div/table/tbody/tr/td[6]') %>%
         html_text2() %>%
         readr::parse_integer()
draws <- draws[1:20]
```

&nbsp;

**Losses**

```{r}
# Losses
losses <- page %>%
  html_nodes(xpath='//*[@class="tableContainer"]/div/table/tbody/tr/td[7]') %>%
  html_text2() %>%
  readr::parse_integer()
losses <- losses[1:20]
```

&nbsp;

**Goals For**

```{r}
# Goals For
goals_for <- page %>%
             html_nodes(xpath='//*[@class="tableContainer"]/div/table/tbody/tr/td[8]') %>%
             html_text2() %>%
             readr::parse_integer()
goals_for <- goals_for[1:20]
```

&nbsp;

**Goals Against**

```{r}
# Goals Against
goals_against <- page %>%
                 html_nodes(xpath='//*[@class="tableContainer"]/div/table/tbody/tr/td[9]') %>%
                 html_text2() %>%
                 readr::parse_integer()
goals_against <- goals_against[1:20]
```

&nbsp;

**Goals Difference**

```{r}
# Goals Difference
goals_diff <- page %>%
              html_nodes(xpath='//*[@class="tableContainer"]/div/table/tbody/tr/td[10]') %>%
              html_text2() %>%
              readr::parse_integer()
goals_diff <- goals_diff[1:20]
```

&nbsp;

**Points**

```{r, warning=FALSE, message = FALSE}
# Points
points <- page %>%
          html_nodes("[class='points']") %>%
          html_text2() %>%
          readr::parse_integer()
points <- points[2:21]

```

&nbsp;

## Create Dataframe

&nbsp;

Once the parts of the table are extracted, the dataframe can be put together.


```{r epl_dataframe}
### Create Dataframe based on raw data:

epl_table <- data.frame(
  Rank = seq(1, 20),
  Club = name,
  Played = played,
  Wins = wins,
  Draws = draws,
  Losses = losses,
  Goals_For = goals_for,
  Goals_Against = goals_against,
  Goals_Difference = goals_diff,
  Points = points
)

## Preview table:

epl_table
```

&nbsp;

## Optional - Saving Dataframe To Files

&nbsp;

As an optional thing, you can save the dataframe as an Excel file or as a .csv file.

```{r}
Sys.Date()
```

```{r}
### Save data Dataframe as Excel File:

library(writexl)

write_xlsx(epl_table, paste("EPL_Table", Sys.Date(), ".xlsx", sep = ""))

## Save dataframe as .csv File Option:

write.csv(epl_table, paste("EPL_Table", Sys.Date(), ".csv", sep = ""), row.names = FALSE)
```