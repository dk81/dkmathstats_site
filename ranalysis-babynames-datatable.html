<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>Analyzing Big Data &amp; Baby Names In R Using data.table</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />

</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 60px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 65px;
  margin-top: -65px;
}

.section h2 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h3 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h4 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h5 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h6 {
  padding-top: 65px;
  margin-top: -65px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->






<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">dkmathstats Website</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="about.html">About</a>
</li>
<li>
  <a href="mathstats_pages.html">Math &amp; Stats Pages</a>
</li>
<li>
  <a href="r-projects.html">R Programming</a>
</li>
<li>
  <a href="python_projects.html">Python Items</a>
</li>
<li>
  <a href="toronto_math_tutoring.html">Toronto Math Tutoring</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Analyzing Big Data &amp; Baby Names In R Using data.table</h1>

</div>


<p> </p>
<center>
<img src="images/baby-name.jpg" />
</center>
<p> </p>
<p>Hello. I have recently been learning and experimenting with the data.table package in the statistical program R. This data.table package is similar to dplyr with data manipulation techniques. Both dplyr and data.table have features which are similar to SQL queries (SELECT, WHERE keywords and so on).</p>
<p>This post will highlight some features from data.table. The dataset being used is an interesting babynames dataset. (Warning: This post is quite long.)</p>
<p> </p>
<div id="table-of-contents" class="section level3">
<h3><u>Table Of Contents</u></h3>
<p> </p>
<ul>
<li><a href="#data">The babynames Dataset</a></li>
<li><a href="#select">Selecting Data Using data.table</a></li>
<li><a href="#rows">Selecting Rows Using i</a></li>
<li><a href="#columns">Selecting Columns in j</a></li>
<li><a href="#by">The by Keyword</a></li>
<li><a href="#ij">Selecting Data in Rows i and Columns j (And The Most Popular Baby Names)</a></li>
<li><a href="#index">Indexing and Keys</a></li>
<li><a href="#names">Changing Column Names</a></li>
<li><a href="#order">Changing Column Order</a></li>
<li><a href="#remove">Removing Columns</a></li>
<li><a href="#summary">Summary</a></li>
<li><a href="#refs">References</a></li>
</ul>
<p><a name="data"></a></p>
<p> </p>
</div>
<div id="the-babynames-dataset" class="section level3">
<h3><u>The babynames Dataset</u></h3>
<p> </p>
<p>The large dataset that we will be working with is from the babynames dataset in R. These baby names are from the United States. Information on this dataset can be found here. The babynames package has datasets named applicants, births, babynames and lifetables.</p>
<p>We can import the library and dataset in R as well as import the data.table library into R.</p>
<p> </p>
<pre class="r"><code># We will work with the babynames dataset:

# To install use: install.packages(&quot;data.table&quot;)

library(babynames)</code></pre>
<pre><code>## Warning: package &#39;babynames&#39; was built under R version 3.4.2</code></pre>
<pre class="r"><code>library(data.table)</code></pre>
<pre><code>## data.table 1.10.4</code></pre>
<pre><code>##   The fastest way to learn (by data.table authors): https://www.datacamp.com/courses/data-analysis-the-data-table-way</code></pre>
<pre><code>##   Documentation: ?data.table, example(data.table) and browseVignettes(&quot;data.table&quot;)</code></pre>
<pre><code>##   Release notes, videos and slides: http://r-datatable.com</code></pre>
<pre class="r"><code>set.seed(45L)

baby_table &lt;- data.table(babynames)</code></pre>
<p> </p>
<p>In the last line, we converted the babynames dataset into a data table and set it to the variable baby_table.</p>
<p> </p>
<hr />
<p> </p>
<p>We check if there is any missing data in the dataset.</p>
<p> </p>
<pre class="r"><code>## Check for any missing values:

sum(is.na(baby_table))</code></pre>
<pre><code>## [1] 0</code></pre>
<p> </p>
<p>The output shows that there are no NAs which represent missing values. The babynames dataset is already ready for data analysis.</p>
<p> </p>
<pre class="r"><code># Dimensions of dataset: (1.82 million rows with 5 columns)
dim(baby_table)</code></pre>
<pre><code>## [1] 1858689       5</code></pre>
<pre class="r"><code># Column names of the baby_data:

names(baby_table)</code></pre>
<pre><code>## [1] &quot;year&quot; &quot;sex&quot;  &quot;name&quot; &quot;n&quot;    &quot;prop&quot;</code></pre>
<p> </p>
<p>Running <code>dim(baby_table)</code> returns the dimension of the dataset which is about 1.825 million rows with 5 columns.</p>
<p>The <code>names()</code> function returns the names of the 5 columns. These 5 columns are year, sex, name, n (the counts for the name), prop (proportion or percentage of total population).</p>
<p> </p>
<pre class="r"><code>str(baby_table)</code></pre>
<pre><code>## Classes &#39;data.table&#39; and &#39;data.frame&#39;:   1858689 obs. of  5 variables:
##  $ year: num  1880 1880 1880 1880 1880 1880 1880 1880 1880 1880 ...
##  $ sex : chr  &quot;F&quot; &quot;F&quot; &quot;F&quot; &quot;F&quot; ...
##  $ name: chr  &quot;Mary&quot; &quot;Anna&quot; &quot;Emma&quot; &quot;Elizabeth&quot; ...
##  $ n   : int  7065 2604 2003 1939 1746 1578 1472 1414 1320 1288 ...
##  $ prop: num  0.0724 0.0267 0.0205 0.0199 0.0179 ...
##  - attr(*, &quot;.internal.selfref&quot;)=&lt;externalptr&gt;</code></pre>
<pre class="r"><code>summary(baby_table)</code></pre>
<pre><code>##       year          sex                name                 n          
##  Min.   :1880   Length:1858689     Length:1858689     Min.   :    5.0  
##  1st Qu.:1950   Class :character   Class :character   1st Qu.:    7.0  
##  Median :1983   Mode  :character   Mode  :character   Median :   12.0  
##  Mean   :1973                                         Mean   :  183.4  
##  3rd Qu.:2002                                         3rd Qu.:   32.0  
##  Max.   :2015                                         Max.   :99680.0  
##       prop          
##  Min.   :2.260e-06  
##  1st Qu.:3.900e-06  
##  Median :7.350e-06  
##  Mean   :1.391e-04  
##  3rd Qu.:2.324e-05  
##  Max.   :8.155e-02</code></pre>
<p> </p>
<p>The <code>str()</code> function returns the structure of the dataset and information about the column variables.</p>
<p>From the <code>summary()</code> function, we retrieve information such as minimum, maximum, mean, median, etc. for the column variables.</p>
<p> </p>
<pre class="r"><code>head(baby_table)</code></pre>
<pre><code>##    year sex      name    n       prop
## 1: 1880   F      Mary 7065 0.07238433
## 2: 1880   F      Anna 2604 0.02667923
## 3: 1880   F      Emma 2003 0.02052170
## 4: 1880   F Elizabeth 1939 0.01986599
## 5: 1880   F    Minnie 1746 0.01788861
## 6: 1880   F  Margaret 1578 0.01616737</code></pre>
<pre class="r"><code>tail(baby_table)</code></pre>
<pre><code>##    year sex   name n         prop
## 1: 2015   M   Zyah 5 2.466855e-06
## 2: 2015   M Zykell 5 2.466855e-06
## 3: 2015   M Zyking 5 2.466855e-06
## 4: 2015   M  Zykir 5 2.466855e-06
## 5: 2015   M  Zyrus 5 2.466855e-06
## 6: 2015   M   Zyus 5 2.466855e-06</code></pre>
<p> </p>
<p>The <code>head()</code> and <code>tail()</code> functions for a dataset returns the first 6 and last 6 (respectively) rows of data. One can use the n = argument to change the number of rows to view. I used <code>n = 10</code> here for both <code>head()</code> and <code>tail()</code> functions.</p>
<p>We see that the names collected were from the years 1880 to 2014.</p>
<p><a name="select"></a></p>
<p> </p>
</div>
<div id="selecting-data-using-data.table" class="section level3">
<h3><u>Selecting Data Using data.table</u></h3>
<p> </p>
<p>The general form for subseting a data table is DT[i, j, by]. This means that we take the data table DT, subset/select rows using “i”, then calculate “j” grouped by “by”.</p>
<p>If the above sounds confusing, please refer to the examples below.</p>
<p><a name="rows"></a></p>
<p> </p>
</div>
<div id="selecting-rows-using-i" class="section level3">
<h3><u>Selecting Rows Using i</u></h3>
<p> </p>
<p>To start off, here is an example where we select rows 25 to 29 in two ways.</p>
<p> </p>
<pre class="r"><code># Format is data_table[i, j, by]

# Selecting rows referring to i:

# Rows from 25 to 28 

baby_table[25:29, ]</code></pre>
<pre><code>##    year sex     name   n        prop
## 1: 1880   F Gertrude 787 0.008063194
## 2: 1880   F    Julia 783 0.008022212
## 3: 1880   F   Hattie 769 0.007878775
## 4: 1880   F    Edith 768 0.007868530
## 5: 1880   F   Mattie 704 0.007212819</code></pre>
<pre class="r"><code>baby_table[25:29]</code></pre>
<pre><code>##    year sex     name   n        prop
## 1: 1880   F Gertrude 787 0.008063194
## 2: 1880   F    Julia 783 0.008022212
## 3: 1880   F   Hattie 769 0.007878775
## 4: 1880   F    Edith 768 0.007868530
## 5: 1880   F   Mattie 704 0.007212819</code></pre>
<p> </p>
<p>Here is an example where we select a row with a condition. We choose rows with the name Marissa.</p>
<p> </p>
<pre class="r"><code># Select rows with a criteria. Name is Marissa

marissa &lt;- baby_table[name == &quot;Marissa&quot;]

head(marissa, n = 10)</code></pre>
<pre><code>##     year sex    name  n         prop
##  1: 1936   F Marissa  5 4.640677e-06
##  2: 1946   F Marissa  7 4.340194e-06
##  3: 1947   F Marissa  7 3.850849e-06
##  4: 1949   F Marissa  7 3.987470e-06
##  5: 1950   F Marissa  7 3.979708e-06
##  6: 1951   F Marissa  7 3.790613e-06
##  7: 1952   F Marissa 15 7.885834e-06
##  8: 1953   F Marissa 20 1.036745e-05
##  9: 1954   F Marissa 20 1.004706e-05
## 10: 1955   F Marissa 40 1.995637e-05</code></pre>
<p> </p>
<p>We can also select rows with multiple names as the condition.</p>
<pre class="r"><code># Select rows with names of Zach and Penny.

baby_table[name %in% c(&quot;Zach&quot;, &quot;Penny&quot;)]</code></pre>
<pre><code>##      year sex  name   n         prop
##   1: 1882   F Penny   5 4.321671e-05
##   2: 1888   F Penny   6 3.167113e-05
##   3: 1890   F Penny   6 2.975290e-05
##   4: 1892   F Penny   6 2.667674e-05
##   5: 1897   F Penny   5 2.013896e-05
##  ---                                
## 227: 2013   M  Zach  71 3.526095e-05
## 228: 2014   F Penny 342 1.756050e-04
## 229: 2014   M  Zach  67 3.284645e-05
## 230: 2015   F Penny 371 1.917205e-04
## 231: 2015   M  Zach  71 3.502935e-05</code></pre>
<p><a name="columns"></a></p>
<p> </p>
</div>
<div id="selecting-columns-in-j" class="section level3">
<h3><u>Selecting Columns in j</u></h3>
<p> </p>
<p>We now select columns from the data table.</p>
<p>In this example, we select the year column from baby_table. (No output shown)</p>
<p> </p>
<pre><code># Selecting columns in j:

# Years column:

years &lt;- baby_table[, year]; </code></pre>
<p> </p>
<p>What if we want to select more than one column. We can certainly do that by using the <code>.()</code> in the j column.</p>
<p> </p>
<pre class="r"><code># Choosing several columns and omit the proportion column:

no_propor &lt;- baby_table[, .(year, sex, name, n)]

head(no_propor)</code></pre>
<pre><code>##    year sex      name    n
## 1: 1880   F      Mary 7065
## 2: 1880   F      Anna 2604
## 3: 1880   F      Emma 2003
## 4: 1880   F Elizabeth 1939
## 5: 1880   F    Minnie 1746
## 6: 1880   F  Margaret 1578</code></pre>
<pre class="r"><code>dim(no_propor)</code></pre>
<pre><code>## [1] 1858689       4</code></pre>
<p> </p>
<p>Instead of using <code>.()</code>, we could use the <code>list()</code> function as follows.</p>
<p> </p>
<pre class="r"><code># Could also use list() function instead of .():

baby_table[, list(year, sex, name, n)]</code></pre>
<pre><code>##          year sex      name    n
##       1: 1880   F      Mary 7065
##       2: 1880   F      Anna 2604
##       3: 1880   F      Emma 2003
##       4: 1880   F Elizabeth 1939
##       5: 1880   F    Minnie 1746
##      ---                        
## 1858685: 2015   M    Zykell    5
## 1858686: 2015   M    Zyking    5
## 1858687: 2015   M     Zykir    5
## 1858688: 2015   M     Zyrus    5
## 1858689: 2015   M      Zyus    5</code></pre>
<p> </p>
<pre class="r"><code># Note that .() is needed to output a data.table object, otherwise we get a vector.

# We can compute on several columns.

counts &lt;- baby_table[, .(Total_Count = sum(n), Standard_Deviation_Counts = sd(n))]

counts</code></pre>
<pre><code>##    Total_Count Standard_Deviation_Counts
## 1:   340851912                  1555.357</code></pre>
<p> </p>
<p>Note that if we do not use <code>.()</code> or <code>list()</code> in j we would not return a data.table object. We would instead get a vector and an undesirable output.</p>
<p>We can also run a few calculations to retrieve counts, means (average), standard deviations and such.</p>
<p><a name="by"></a></p>
<p> </p>
<hr />
</div>
<div id="the-by-keyword" class="section level3">
<h3><u>The by Keyword</u></h3>
<p> </p>
<p>In the previous example, we found the sum of n as the counts and the standard deviations of the counts. The results we found for both male and female genders.</p>
<p>What if we want to find counts, averages and such grouped by gender for example? We use the by keyword.</p>
<p>The example below counts the number of rows for each gender. Note that .N counts the number of rows.</p>
<p> </p>
<pre class="r"><code># Using the by:

# Calculating the number of rows for each group in sex column: (.N for counting)

gender_count &lt;- baby_table[, .N, by = sex]

gender_count</code></pre>
<pre><code>##    sex       N
## 1:   F 1100858
## 2:   M  757831</code></pre>
<p> </p>
<p>The counts above were the number of rows for each gender. But each row has an n value of the counts per row. We have to sum these n values for each gender to retrieve the true counts for each gender.</p>
<pre class="r"><code># Calculating the total number of males and females:

gender &lt;- baby_table[, .(Total.Gender = sum(n)), by = sex]

gender</code></pre>
<pre><code>##    sex Total.Gender
## 1:   F    168861581
## 2:   M    171990331</code></pre>
<p> </p>
<p>We now check if the female total counts and the male total counts match the total counts from the last example in the previous section.</p>
<p> </p>
<pre class="r"><code># Check if the gender counts for male and female equals total counts
# (Is 337135426 = 167070477 + 170064949?)

counts[, Total_Count] == (sum(gender[, Total.Gender]))</code></pre>
<pre><code>## [1] TRUE</code></pre>
<p><a name="ij"></a></p>
<p> </p>
</div>
<div id="selecting-data-in-rows-i-and-columns-j" class="section level3">
<h3><u>Selecting Data in Rows i and Columns j</u></h3>
<p> </p>
<p>We can now select data from rows i and columns j in the data table. The examples below are neat examples as we investigate the popular baby names.</p>
<p> </p>
<p><strong>The 15 Most Popular Baby Names</strong></p>
<p> </p>
<p>We find out the 15 most popular baby names (Male and female) from the dataset.</p>
<p> </p>
<pre class="r"><code># Combine i and j. Most popular baby names in dataset.

baby_table &lt;- data.table(babynames)

aggregate &lt;- baby_table[, .(Name.Count = sum(n)), by = name][order(-Name.Count)]

head(aggregate, n = 15)</code></pre>
<pre><code>##            name Name.Count
##  1:       James    5144205
##  2:        John    5117331
##  3:      Robert    4823167
##  4:     Michael    4345569
##  5:        Mary    4133216
##  6:     William    4087556
##  7:       David    3602623
##  8:      Joseph    2592388
##  9:     Richard    2567700
## 10:     Charles    2383998
## 11:      Thomas    2298810
## 12: Christopher    2014117
## 13:      Daniel    1890558
## 14:   Elizabeth    1616108
## 15:    Patricia    1575916</code></pre>
<p> </p>
<p>We see that the name James is the most popular baby name from the dataset</p>
<p>Notice that the by keyword was used and that a the sum function was used to create a new variable Name.Count. In addition, we used chaining with the order command. Instead of having</p>
<p> </p>
<pre><code># Long way:

aggregate &lt;- baby_table[, .(Name.Count = sum(n)), by = name]
aggregate &lt;- aggregate[order(-Name.Count)]</code></pre>
<p> </p>
<p>you can use chaining to do in one line as illustrated in the image above.</p>
<p> </p>
<pre><code>aggregate &lt;- baby_table[, .(Name.Count = sum(n)), by = name][order(-Name.Count)]</code></pre>
<p> </p>
<hr />
<p> </p>
<p><strong>The 15 Most Popular Male Baby Names</strong></p>
<p> </p>
<p>Now we look at the 15 most popular male baby names.</p>
<p> </p>
<pre class="r"><code>agg_male &lt;- baby_table[sex == &quot;M&quot;, .(Name.Count = sum(n)), by = name][order(-Name.Count)]

head(agg_male, n = 15)</code></pre>
<pre><code>##            name Name.Count
##  1:       James    5120990
##  2:        John    5095674
##  3:      Robert    4803068
##  4:     Michael    4323928
##  5:     William    4071645
##  6:       David    3589754
##  7:      Joseph    2581785
##  8:     Richard    2558165
##  9:     Charles    2371621
## 10:      Thomas    2290364
## 11: Christopher    2004667
## 12:      Daniel    1882435
## 13:     Matthew    1566027
## 14:      George    1457646
## 15:     Anthony    1413852</code></pre>
<p> </p>
<p>We see that the 5 most popular male baby names are James, John, Robert, Michael and William.</p>
<hr />
<p><strong>The 15 Most Popular Female Baby Names</strong></p>
<p>We now present the 15 most popular female baby names.</p>
<p> </p>
<pre class="r"><code>agg_female &lt;- baby_table[sex == &quot;F&quot;, .(Name.Count = sum(n)), by = name][order(-Name.Count)]

head(agg_female, n = 15)</code></pre>
<pre><code>##          name Name.Count
##  1:      Mary    4118058
##  2: Elizabeth    1610948
##  3:  Patricia    1570954
##  4:  Jennifer    1464067
##  5:     Linda    1451331
##  6:   Barbara    1433339
##  7:  Margaret    1242141
##  8:     Susan    1120810
##  9:   Dorothy    1106106
## 10:     Sarah    1065265
## 11:   Jessica    1042201
## 12:     Helen    1016686
## 13:     Nancy    1001342
## 14:     Betty     999066
## 15:     Karen     984468</code></pre>
<p> </p>
<p>The top five female baby names from the dataset are Mary, Elizabeth, Patricia, Jennifer and Linda.</p>
<p><a name="index"></a></p>
<p> </p>
<hr />
</div>
<div id="indexing-and-keys" class="section level3">
<h3><u>Indexing and Keys</u></h3>
<p> </p>
<p>We can also subset and select data using keys.</p>
<p>To start off, we create a new copy of the babynames dataset and name it key_table. The <code>setkey()</code> function takes a data table and a column(s) as reference. In the code below, we put the name column in <code>setkey()</code>. When I input key_table[“Mario”], “Mario” would refer to the “Mario” in the name column of key_table and all rows containing the name “Mario” would be shown.</p>
<p> </p>
<pre class="r"><code># Indexing and keys:

key_table &lt;- data.table(babynames)

# Set key on our data table with column name:
setkey(key_table, name)

# name is keyed column, search for rows with name = &quot;Mario&quot;

key_table[&quot;Mario&quot;]</code></pre>
<pre><code>##      year sex  name    n         prop
##   1: 1897   M Mario    7 5.740387e-05
##   2: 1900   M Mario    5 3.083755e-05
##   3: 1901   M Mario    6 5.190536e-05
##   4: 1902   M Mario   10 7.533013e-05
##   5: 1903   M Mario    6 4.639438e-05
##  ---                                 
## 180: 2011   M Mario 1597 7.879047e-04
## 181: 2012   M Mario 1442 7.126023e-04
## 182: 2013   M Mario 1417 7.037291e-04
## 183: 2014   M Mario 1361 6.672242e-04
## 184: 2015   M Mario 1285 6.339818e-04</code></pre>
<p> </p>
<p>The next example is about selecting multiple names in <code>setkey()</code>.</p>
<p> </p>
<pre class="r"><code># name is the keyed column
# search for all rows where name is Mario or Dennis:
key_table[c(&quot;Mario&quot;, &quot;Dennis&quot;)]</code></pre>
<pre><code>##      year sex   name   n         prop
##   1: 1897   M  Mario   7 5.740387e-05
##   2: 1900   M  Mario   5 3.083755e-05
##   3: 1901   M  Mario   6 5.190536e-05
##   4: 1902   M  Mario  10 7.533013e-05
##   5: 1903   M  Mario   6 4.639438e-05
##  ---                                 
## 413: 2012   M Dennis 658 3.251681e-04
## 414: 2013   M Dennis 622 3.089058e-04
## 415: 2014   F Dennis   6 3.080789e-06
## 416: 2014   M Dennis 573 2.809107e-04
## 417: 2015   M Dennis 584 2.881287e-04</code></pre>
<p> </p>
<hr />
<p><strong>The nomatch argument</strong></p>
<p> </p>
<p>The nomatch argument is for cases where a specified value in the row does not match in the data table rows. If I search for the name “What” alongside with “April” without the nomatch argument I will get NAs (missing values).</p>
<p> </p>
<pre class="r"><code># nomatch argument for the case where a value in the row does not match the data table rows
# By default it is NA, nomatch = 0 means no rows to be returned if no matches

key_table[c(&quot;April&quot;, &quot;What&quot;)]</code></pre>
<pre><code>##      year sex  name   n         prop
##   1: 1917   F April   6 5.339494e-06
##   2: 1919   F April   8 6.810539e-06
##   3: 1920   F April  10 8.038340e-06
##   4: 1921   F April  12 9.377337e-06
##   5: 1923   F April   6 4.790740e-06
##  ---                                
## 131: 2012   F April 782 4.043327e-04
## 132: 2013   F April 716 3.727317e-04
## 133: 2014   F April 793 4.071776e-04
## 134: 2015   F April 797 4.118631e-04
## 135:   NA  NA  What  NA           NA</code></pre>
<p> </p>
<p>By default, the nomatch argument is set to NA as follows.</p>
<p> </p>
<pre class="r"><code>key_table[c(&quot;April&quot;, &quot;What&quot;), nomatch = NA]</code></pre>
<pre><code>##      year sex  name   n         prop
##   1: 1917   F April   6 5.339494e-06
##   2: 1919   F April   8 6.810539e-06
##   3: 1920   F April  10 8.038340e-06
##   4: 1921   F April  12 9.377337e-06
##   5: 1923   F April   6 4.790740e-06
##  ---                                
## 131: 2012   F April 782 4.043327e-04
## 132: 2013   F April 716 3.727317e-04
## 133: 2014   F April 793 4.071776e-04
## 134: 2015   F April 797 4.118631e-04
## 135:   NA  NA  What  NA           NA</code></pre>
<p> </p>
<p>Setting nomatch to 0 will omit the row(s) which are not a match.</p>
<p> </p>
<pre class="r"><code>key_table[c(&quot;April&quot;, &quot;What&quot;), nomatch = 0]</code></pre>
<pre><code>##      year sex  name   n         prop
##   1: 1917   F April   6 5.339494e-06
##   2: 1919   F April   8 6.810539e-06
##   3: 1920   F April  10 8.038340e-06
##   4: 1921   F April  12 9.377337e-06
##   5: 1923   F April   6 4.790740e-06
##  ---                                
## 130: 2011   F April 792 4.096533e-04
## 131: 2012   F April 782 4.043327e-04
## 132: 2013   F April 716 3.727317e-04
## 133: 2014   F April 793 4.071776e-04
## 134: 2015   F April 797 4.118631e-04</code></pre>
<p> </p>
<hr />
<p><strong>Counting Methods</strong></p>
<p> </p>
<p>Using the keys we can also get counts. The two examples show counting where one is aggregated and the other one is separated.</p>
<p> </p>
<pre class="r"><code># Counting Methods:
# Counting the number of Marios and Marias (together):

key_table[c(&quot;Mario&quot;, &quot;Maria&quot;), sum(n)]</code></pre>
<pre><code>## [1] 684551</code></pre>
<pre class="r"><code># Counting the number of Marios and Marias separately:

key_table[c(&quot;Mario&quot;, &quot;Maria&quot;), sum(n), by = .EACHI]</code></pre>
<pre><code>##     name     V1
## 1: Mario 142805
## 2: Maria 541746</code></pre>
<p> </p>
<hr />
<p><strong>Selecting Multiple Columns in Keys</strong></p>
<p> </p>
<p>Earlier, we set the name column in the <code>setkey()</code> function. We can also put multiple columns into <code>setkey()</code>. Here are some examples.</p>
<p> </p>
<pre class="r"><code>## Selecting multiple columns in keys:

# Select year and name columns as keys, sort by year then name:

key_table &lt;- data.table(babynames)

setkey(key_table, year, name)

# Search for the year 2000 with name Sophie:

key_table[.(2000, &quot;Sophie&quot;)]</code></pre>
<pre><code>##    year sex   name    n        prop
## 1: 2000   F Sophie 2102 0.001053919</code></pre>
<pre class="r"><code># Search for years 2000, 2001 with names Caitlin and Raj:

key_table[.(c(2000, 2001), c(&quot;Caitlin&quot;, &quot;Raj&quot;))]</code></pre>
<pre><code>##    year sex    name    n         prop
## 1: 2000   F Caitlin 4102 2.056696e-03
## 2: 2000   M Caitlin    5 2.395811e-06
## 3: 2001   M     Raj   74 3.580083e-05</code></pre>
<p><a name="names"></a></p>
<p> </p>
<hr />
</div>
<div id="changing-column-names" class="section level3">
<h3><u>Changing Column Names</u></h3>
<p> </p>
<p>There are times when column names could use improvements. For example, the column n is understood by mostly math, stats and computer science type people but it is better to replace n with Count (or something similar).</p>
<p> </p>
<pre class="r"><code># Changing column names (from &quot;n&quot; to &quot;Count&quot;):

new_col &lt;- data.table(babynames)

new_col &lt;- setnames(new_col, &quot;n&quot;, &quot;Count&quot;)

head(new_col, n = 10)</code></pre>
<pre><code>##     year sex      name Count       prop
##  1: 1880   F      Mary  7065 0.07238433
##  2: 1880   F      Anna  2604 0.02667923
##  3: 1880   F      Emma  2003 0.02052170
##  4: 1880   F Elizabeth  1939 0.01986599
##  5: 1880   F    Minnie  1746 0.01788861
##  6: 1880   F  Margaret  1578 0.01616737
##  7: 1880   F       Ida  1472 0.01508135
##  8: 1880   F     Alice  1414 0.01448711
##  9: 1880   F    Bertha  1320 0.01352404
## 10: 1880   F     Sarah  1288 0.01319618</code></pre>
<p><a name="order"></a></p>
<p> </p>
<hr />
</div>
<div id="changing-column-order" class="section level3">
<h3><u>Changing Column Order</u></h3>
<p> </p>
<p>In the original babynames dataset we had “year”, “sex”, “name”, “n”, “prop”. Here, we want to but the name before sex. We can also change the order of the columns as follows.</p>
<pre class="r"><code># Change column order:

ordered &lt;- data.table(babynames)

new_order &lt;- c(&quot;year&quot;, &quot;name&quot;, &quot;sex&quot;, &quot;n&quot;, &quot;prop&quot;)

setcolorder(ordered, new_order)

head(ordered, n = 10)</code></pre>
<pre><code>##     year      name sex    n       prop
##  1: 1880      Mary   F 7065 0.07238433
##  2: 1880      Anna   F 2604 0.02667923
##  3: 1880      Emma   F 2003 0.02052170
##  4: 1880 Elizabeth   F 1939 0.01986599
##  5: 1880    Minnie   F 1746 0.01788861
##  6: 1880  Margaret   F 1578 0.01616737
##  7: 1880       Ida   F 1472 0.01508135
##  8: 1880     Alice   F 1414 0.01448711
##  9: 1880    Bertha   F 1320 0.01352404
## 10: 1880     Sarah   F 1288 0.01319618</code></pre>
<p><a name="remove"></a></p>
<p> </p>
<hr />
</div>
<div id="removing-columns" class="section level3">
<h3><u>Removing Columns</u></h3>
<p> </p>
<p>In data.table we can also remove columns. One should be careful when removing columns. It is like chopping a carrot; once it is cut you can’t put it back together.</p>
<p>Here is the case with removing one column.</p>
<p> </p>
<pre class="r"><code># Remove a column:

no_years &lt;- data.table(babynames)

no_years &lt;- no_years[, year := NULL];

head(no_years);</code></pre>
<pre><code>##    sex      name    n       prop
## 1:   F      Mary 7065 0.07238433
## 2:   F      Anna 2604 0.02667923
## 3:   F      Emma 2003 0.02052170
## 4:   F Elizabeth 1939 0.01986599
## 5:   F    Minnie 1746 0.01788861
## 6:   F  Margaret 1578 0.01616737</code></pre>
<p> </p>
<p>We can also remove multiple columns. Here, we remove the year, sex and prop columns leaving us with the name and n columns.</p>
<p> </p>
<pre class="r"><code># Remove year, sex and prop columns but keep the name and n columns:

just_names &lt;- data.table(babynames) # Create new copy.

just_names &lt;- just_names[, c(&quot;year&quot;, &quot;sex&quot;, &quot;prop&quot;) := NULL];

head(just_names, n = 20)</code></pre>
<pre><code>##          name    n
##  1:      Mary 7065
##  2:      Anna 2604
##  3:      Emma 2003
##  4: Elizabeth 1939
##  5:    Minnie 1746
##  6:  Margaret 1578
##  7:       Ida 1472
##  8:     Alice 1414
##  9:    Bertha 1320
## 10:     Sarah 1288
## 11:     Annie 1258
## 12:     Clara 1226
## 13:      Ella 1156
## 14:  Florence 1063
## 15:      Cora 1045
## 16:    Martha 1040
## 17:     Laura 1012
## 18:    Nellie  995
## 19:     Grace  982
## 20:    Carrie  949</code></pre>
<p><a name="summary"></a></p>
<p> </p>
</div>
<div id="summary" class="section level3">
<h3><u>Summary</u></h3>
<p> </p>
<p>Well, that was a lot to digest and take in. In short, the data.table package in R allows for data selection, data extraction and data manipulation of (large) data sets. Since computing power has increased tremendously over the years, it is easier and faster to analyze big data.</p>
<p>We have also learned some neat things from the babynames dataset which is close to 2 million rows and 5 columns. From 1880 to 2014, the most popular male name is James and the most popular female name is Mary. Overall the most popular names (1880 to 2014) are James, John, Robert, Michael and Mary.</p>
<p>In the US, there are more babies named Maria (Count: 538815) than Mario (Count: 141494) from 1880 to 2014.</p>
<p>It is unknown whether name variations such as Rob for Robert and Bill for William are counted as the same or not. One could use these baby names statistics to predict the most popular baby name (male and female) for 2016, 2017 , and so forth. Predictions can be made using this entire dataset or the most recent years (2004 to 2014) in the dataset for example.</p>
<p>More can done with this dataset such as look at the years from 2000 to 2014 for example.</p>
<p><a name="refs"></a></p>
<p> </p>
</div>
<div id="references" class="section level3">
<h3><u>References</u></h3>
<p> </p>
<p>The babynames dataset documentation: <a href="https://cran.r-project.org/web/packages/babynames/babynames.pdf" class="uri">https://cran.r-project.org/web/packages/babynames/babynames.pdf</a></p>
<p>This cheat sheet for data.table has been really useful.</p>
<p><a href="https://s3.amazonaws.com/assets.datacamp.com/img/blog/data+table+cheat+sheet.pdf" class="uri">https://s3.amazonaws.com/assets.datacamp.com/img/blog/data+table+cheat+sheet.pdf</a></p>
<p>The interesting featured image is from <a href="http://parentingatoz.com/wp-content/uploads/2015/09/baby-name.jpg" class="uri">http://parentingatoz.com/wp-content/uploads/2015/09/baby-name.jpg</a></p>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
