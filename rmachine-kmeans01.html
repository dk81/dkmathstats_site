<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>k-Means Clustering In R</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />

</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 60px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 65px;
  margin-top: -65px;
}

.section h2 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h3 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h4 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h5 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h6 {
  padding-top: 65px;
  margin-top: -65px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->






<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">dkmathstats Website</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="about.html">About</a>
</li>
<li>
  <a href="mathstats_pages.html">Math &amp; Stats Pages</a>
</li>
<li>
  <a href="r-projects.html">R Programming</a>
</li>
<li>
  <a href="python_projects.html">Python Items</a>
</li>
<li>
  <a href="toronto_math_tutoring.html">Toronto Math Tutoring</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">k-Means Clustering In R</h1>

</div>


<p> </p>
<p>Hi there. In this page, I play around with data and apply K-Means Clustering. K-Means Clustering is an unsupervised machine learning technique which groups/clusters data points into a specific number of groups. The user of the algorithm specifies the number of groups by setting the K-Value.</p>
<p>In R (RStudio), I load in the <code>ggplot2</code> and <code>faraway</code> packages.</p>
<p> </p>
<pre class="r"><code>## R Markdown

# K-Means Clustering work.
# References:
# https://www.r-bloggers.com/k-means-clustering-in-r/
# R Graphics Cookbook
# R Graphics Cookbook By Winston Chang

# https://www.r-bloggers.com/k-means-clustering-in-r/
  
# http://stackoverflow.com/questions/14524818/results-of-k-means-used-in-r
# Datacamp Account Notes

library(faraway)
library(ggplot2)

# Save star data from faraway data to star_data variable:

star_data &lt;- star

# Preview data:

head(star_data)</code></pre>
<pre><code>##   index temp light
## 1     1 4.37  5.23
## 2     2 4.56  5.74
## 3     3 4.26  4.93
## 4     4 4.56  5.74
## 5     5 4.30  5.19
## 6     6 4.46  5.46</code></pre>
<p> </p>
<p>From the <code>head()</code> function of <code>star_data</code>, you see that there is an index column which is the same as the row numbers. This column can be removed.</p>
<p> </p>
<pre class="r"><code># Remove first column as it is not needed:

star_data &lt;- star_data[, 2:3]</code></pre>
<p> </p>
<p>You can explore the dataset even more with the use of the <code>summary()</code> and <code>str()</code> functions.</p>
<pre class="r"><code># Summary and data structure:

summary(star_data)</code></pre>
<pre><code>##       temp           light      
##  Min.   :3.480   Min.   :3.940  
##  1st Qu.:4.275   1st Qu.:4.540  
##  Median :4.420   Median :5.100  
##  Mean   :4.310   Mean   :5.012  
##  3rd Qu.:4.455   3rd Qu.:5.435  
##  Max.   :4.620   Max.   :6.290</code></pre>
<pre class="r"><code>str(star_data)</code></pre>
<pre><code>## &#39;data.frame&#39;:    47 obs. of  2 variables:
##  $ temp : num  4.37 4.56 4.26 4.56 4.3 4.46 3.84 4.57 4.26 4.37 ...
##  $ light: num  5.23 5.74 4.93 5.74 5.19 5.46 4.65 5.27 5.57 5.12 ...</code></pre>
<p> </p>
<p>With the use of <code>ggplot2</code> graphics, you can generate a nice initial scatterplot to have a sense of what the data is like.</p>
<pre class="r"><code># Initial Plot (With Full Labels)

ggplot(star_data, aes(x = temp, y = light)) + geom_point() + 
  labs(x = &quot;\n Log Of Surface Temperature&quot;, y = &quot;Log Of Light Intensity \n&quot;, 
       title = &quot;Temperature Vs Light Intensity \n For Star Data \n&quot;) + 
  theme(plot.title = element_text(hjust = 0.5), 
        axis.title.x = element_text(face=&quot;bold&quot;, colour = &quot;darkgreen&quot;, size = 12),
        axis.title.y = element_text(face=&quot;bold&quot;, colour = &quot;darkgreen&quot;, size = 12),
        legend.title = element_text(face=&quot;bold&quot;, size = 10))</code></pre>
<p><img src="rmachine-kmeans01_files/figure-html/unnamed-chunk-4-1.png" width="432" /></p>
<p> </p>
<div id="k-means-clustering-in-r" class="section level2">
<h2>K-Means Clustering In R</h2>
<p> </p>
<p>Doing K-Means Clustering In R is not too difficult. To do the clustering use the <code>kemans()</code> command in R.</p>
<pre class="r"><code># k-Means Clustering In R
  
# Set random seed:

set.seed(20)

star_Cluster &lt;- kmeans(star_data, centers = 2, nstart = 25)
star_Cluster</code></pre>
<pre><code>## K-means clustering with 2 clusters of sizes 27, 20
## 
## Cluster means:
##       temp    light
## 1 4.320741 5.423704
## 2 4.295500 4.456500
## 
## Clustering vector:
##  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 
##  1  1  2  1  1  1  2  1  1  1  1  1  1  2  2  2  2  2  2  1  2  2  2  2  1 
## 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 
##  2  2  2  2  1  2  1  1  1  2  1  1  1  1  1  2  1  1  1  1  1  2 
## 
## Within cluster sum of squares by cluster:
## [1] 6.254615 1.891550
##  (between_SS / total_SS =  56.9 %)
## 
## Available components:
## 
## [1] &quot;cluster&quot;      &quot;centers&quot;      &quot;totss&quot;        &quot;withinss&quot;    
## [5] &quot;tot.withinss&quot; &quot;betweenss&quot;    &quot;size&quot;         &quot;iter&quot;        
## [9] &quot;ifault&quot;</code></pre>
<p> </p>
<p>From the <code>star_Cluster</code> output, you can see the centers of each cluster as a co-ordinate. In addition, you can see which points are assigned to each cluster. (The two clusters are 1 and 2.)</p>
<p>In the next pieces of code, I create a new copy of the <code>star_data</code> dataset and add the cluster assignments as a new column. This will help with plotting later.</p>
<p> </p>
<pre class="r"><code># Create new copy of star_data for kmeans with 2 clusters

star_data_cl2 &lt;- star_data

# Add star_Cluster cluster component as new column to star_data_cl2:

star_data_cl2$clusterType &lt;- as.factor(star_Cluster$cluster)</code></pre>
<p> </p>
<p>This <code>ggplot</code> code chunk is very similar to the previous one. What is included is <code>colour = clusterType</code> in the <code>aes()</code> part in <code>ggplot()</code>.</p>
<p> </p>
<pre class="r"><code># Plot with Two Clusters Indicated By Colours:

ggplot(star_data_cl2, aes(x = temp, y = light, colour = clusterType)) + 
  geom_point() + 
  labs(x = &quot;\n Log Of Surface Temperature&quot;, y = &quot;Log Of Light Intensity \n&quot;, 
       title = &quot;Temperature Vs Light Intensity For Star Data \n&quot;,
       colour = &quot;Cluster Group&quot;) +  
  theme(plot.title = element_text(hjust = 0.5), 
        axis.title.x = element_text(face=&quot;bold&quot;, colour = &quot;darkgreen&quot;, size = 12),
        axis.title.y = element_text(face=&quot;bold&quot;, colour = &quot;darkgreen&quot;, size = 12),
        legend.title = element_text(face=&quot;bold&quot;, size = 10))</code></pre>
<p><img src="rmachine-kmeans01_files/figure-html/unnamed-chunk-7-1.png" width="432" /></p>
<p> </p>
<p>You can explore the outputs from the K-Means algorithm in R. Refer to the code with comments below.</p>
<pre class="r"><code>#----------------------------------------------
## Understanding the outputs of k-means:

# cluster output from star_cluster:

star_Cluster$cluster</code></pre>
<pre><code>##  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 
##  1  1  2  1  1  1  2  1  1  1  1  1  1  2  2  2  2  2  2  1  2  2  2  2  1 
## 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 
##  2  2  2  2  1  2  1  1  1  2  1  1  1  1  1  2  1  1  1  1  1  2</code></pre>
<pre class="r"><code># Cluster centres:

star_Cluster$centers</code></pre>
<pre><code>##       temp    light
## 1 4.320741 5.423704
## 2 4.295500 4.456500</code></pre>
<pre class="r"><code># Size Of Each Cluster:

star_Cluster$size</code></pre>
<pre><code>## [1] 27 20</code></pre>
<pre class="r"><code># Number of Iterations:

star_Cluster$iter</code></pre>
<pre><code>## [1] 1</code></pre>
<pre class="r"><code># ifault component:

star_Cluster$ifault</code></pre>
<pre><code>## [1] 0</code></pre>
<pre class="r"><code># Within Cluster sum of squares (Sum Of Squares In Each Cluster):

star_Cluster$withinss</code></pre>
<pre><code>## [1] 6.254615 1.891550</code></pre>
<pre class="r"><code># Total Within Sum of Squares (Add Within Cluster SumSquares Together):

star_Cluster$tot.withinss</code></pre>
<pre><code>## [1] 8.146165</code></pre>
<pre class="r"><code># Between Clusters Sum Of Squares:

star_Cluster$betweenss</code></pre>
<pre><code>## [1] 10.75542</code></pre>
<pre class="r"><code># Total Sum Of Squares = BetweenSumSquares + Total Within SumSquares

star_Cluster$totss</code></pre>
<pre><code>## [1] 18.90159</code></pre>
<p> </p>
</div>
<div id="scree-plots-for-determining-the-optimal-number-of-clusters" class="section level2">
<h2>Scree Plots For Determining The Optimal Number Of Clusters</h2>
<p> </p>
<p>A natural question would be how many clusters to choose on the data? What is an objective way of determining the number of clusters? One way is with the us of a visual aid called the scree plot.</p>
<p>To develop a scree plot, a dataset needs to be constructed such that there are a sequence of the number of clusters in one column along with its corresponding total within cluster sum of squares in another column.</p>
<p> </p>
<pre class="r"><code>####  Optimal Amount Of Clusters (k):

# Scree Plot For Determining Optimal k Clusters.

total_wsumsq &lt;- rep(0, 8) #Initialize

for (k in 1:8){
  star_kmeans &lt;- kmeans(star_data, centers = k, nstart = 25)
  
  # Scree Plot: use total within cluster sum of squares
  
  total_wsumsq[k] &lt;- star_kmeans$tot.withinss 
}</code></pre>
<p> </p>
<p>Generating a scree plot in base R is quite simple. The default <code>plot()</code> should do.</p>
<p> </p>
<pre class="r"><code>## Scree Plot In Base R:

plot(x = 1:8, y = total_wsumsq , xlab = &quot;Number Of Clusters (k)&quot;, 
     ylab = &quot;Total Within Sum Of Squares&quot;) +
  lines(x = 1:8, y = total_wsumsq)</code></pre>
<p><img src="rmachine-kmeans01_files/figure-html/unnamed-chunk-10-1.png" width="432" /></p>
<pre><code>## integer(0)</code></pre>
<p> </p>
<p>Generating a scree plot with <code>ggplot2</code> graphics requires a little bit more work. Before using the <code>ggplot()</code> function and its add-on functions a data frame needs to be constructed.</p>
<pre class="r"><code>## ggplot2 Version Of Scree Plot:

# Create table

scree_table &lt;- data.frame(cbind(1:8, total_wsumsq))

scree_table </code></pre>
<pre><code>##   V1 total_wsumsq
## 1  1   18.9015872
## 2  2    8.1461648
## 3  3    3.1994379
## 4  4    1.9850971
## 5  5    1.4314322
## 6  6    1.1715345
## 7  7    0.9351188
## 8  8    0.7721180</code></pre>
<pre class="r"><code># Change column names:

colnames(scree_table) &lt;- c(&quot;k&quot;, &quot;TWSS&quot;)

# Scree ggplot plot:
ggplot(scree_table, aes(x = k, y = TWSS)) + geom_point() + geom_line() +
  labs(x = &quot;\n Number Of Clusters (k)&quot;, y = &quot;Total Within Sum Of Squares \n&quot;, 
       title = &quot;Scree Plot For Star Data \n&quot;) + 
  theme(plot.title = element_text(hjust = 0.5), 
        axis.title.x = element_text(face=&quot;bold&quot;, colour = &quot;darkgreen&quot;, size = 12),
        axis.title.y = element_text(face=&quot;bold&quot;, colour = &quot;darkgreen&quot;, size = 12),
        legend.title = element_text(face=&quot;bold&quot;, size = 10))</code></pre>
<p><img src="rmachine-kmeans01_files/figure-html/unnamed-chunk-11-1.png" width="432" /></p>
<p> </p>
<p>When it comes to selecting the optimal number of clusters, look for the “elbow” in the scree plot. From the scree plot, a good choice for k is 3.</p>
<p> </p>
<pre class="r"><code># From scree plot, choose k = 3 as our optimal choice for k:

star_km3 &lt;- kmeans(star_data, centers = 3, nstart = 25)
star_km3</code></pre>
<pre><code>## K-means clustering with 3 clusters of sizes 17, 4, 26
## 
## Cluster means:
##       temp    light
## 1 4.281176 4.379412
## 2 3.487500 5.990000
## 3 4.455385 5.275385
## 
## Clustering vector:
##  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 
##  3  3  3  3  3  3  1  3  3  3  2  3  3  1  1  1  1  1  1  2  1  1  1  3  3 
## 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 
##  1  1  3  1  2  1  3  3  2  1  3  3  3  3  3  1  3  3  3  3  3  1 
## 
## Within cluster sum of squares by cluster:
## [1] 1.165071 0.171275 1.863092
##  (between_SS / total_SS =  83.1 %)
## 
## Available components:
## 
## [1] &quot;cluster&quot;      &quot;centers&quot;      &quot;totss&quot;        &quot;withinss&quot;    
## [5] &quot;tot.withinss&quot; &quot;betweenss&quot;    &quot;size&quot;         &quot;iter&quot;        
## [9] &quot;ifault&quot;</code></pre>
<pre class="r"><code># Create table:

star_km3_cl &lt;- star_data

# Add star_km3 cluster component as new column to star_km3:

star_km3_cl$clusterType &lt;- as.factor(star_km3$cluster)

# Plot with Clusters Indicated By Colours:

ggplot(star_km3_cl, aes(x = temp, y = light, color = clusterType)) + 
  geom_point() + 
  labs(x = &quot;\n Log Of Surface Temperature&quot;, y = &quot;Log Of Light Intensity \n&quot;, 
       title = &quot;Temperature Vs Light Intensity For Star Data \n&quot;,
       colour = &quot;Cluster Group&quot;) + 
  theme(plot.title = element_text(hjust = 0.5), 
        axis.title.x = element_text(face=&quot;bold&quot;, colour = &quot;darkgreen&quot;, size = 12),
        axis.title.y = element_text(face=&quot;bold&quot;, colour = &quot;darkgreen&quot;, size = 12),
        legend.title = element_text(face=&quot;bold&quot;, size = 10))</code></pre>
<p><img src="rmachine-kmeans01_files/figure-html/unnamed-chunk-12-1.png" width="432" /></p>
<p> </p>
<p><strong>Alternate Scree Plots</strong></p>
<p> </p>
<pre class="r"><code>### --- An Alternate Scree Plot - One (Proportions):


# Alternate Scree Plot For Determining Optimal k Clusters.

ratio &lt;- rep(0, 8)


for (k in 1:8){
  star_kmeans &lt;- kmeans(star_data, centers = k, nstart = 25)
  
  # Scree Plot use total within cluster sum of squares divided by
  # Total sum of squares as a ratio
  
  ratio[k] &lt;- star_kmeans$tot.withinss / star_kmeans$totss
  
}

# Create table

alt_scree &lt;- data.frame(cbind(1:8, ratio))

alt_scree</code></pre>
<pre><code>##   V1      ratio
## 1  1 1.00000000
## 2  2 0.43097782
## 3  3 0.16926821
## 4  4 0.10502277
## 5  5 0.07573080
## 6  6 0.06198074
## 7  7 0.04961176
## 8  8 0.04084937</code></pre>
<pre class="r"><code># Change column names:

colnames(alt_scree) &lt;- c(&quot;k&quot;, &quot;Ratio&quot;)

# Scree ggplot plot:
ggplot(alt_scree, aes(x = k, y = Ratio)) + geom_point() + geom_line() + 
  labs(x = &quot;\n Number Of Clusters (k)&quot;, y = &quot;Within Sum Of Squares / Total Sum Of Squares Ratio \n&quot;, 
       title = &quot;Scree Plot For Star Data \n&quot;) + 
  theme(plot.title = element_text(hjust = 0.5), 
        axis.title.x = element_text(face=&quot;bold&quot;, colour = &quot;darkgreen&quot;, size = 12),
        axis.title.y = element_text(face=&quot;bold&quot;, colour = &quot;darkgreen&quot;, size = 12),
        legend.title = element_text(face=&quot;bold&quot;, size = 10))</code></pre>
<p><img src="rmachine-kmeans01_files/figure-html/unnamed-chunk-13-1.png" width="432" /></p>
<p> </p>
<p>The second alternate scree plot focuses on total variance which is the between sum of squares divided by the total sum of squares. Instead of an elbow, look for the part where it goes from steep to flat.</p>
<p> </p>
<pre class="r"><code>## An Alternate Scree Plot - Two (Total Variance) :

total_var &lt;- rep(0, 8)

for (k in 1:8){
  star_kmeans &lt;- kmeans(star_data, centers = k, nstart = 25)
  
  # Scree Plot with total variance: Between Sum Of Squares / Total_SumSquares
  
  total_var[k] &lt;- round( 100 * star_kmeans$betweenss / star_kmeans$totss, 2)
  
}

# Create table

alt_scree2 &lt;- data.frame(cbind(1:8, total_var))

alt_scree2</code></pre>
<pre><code>##   V1 total_var
## 1  1      0.00
## 2  2     56.90
## 3  3     83.07
## 4  4     89.50
## 5  5     92.43
## 6  6     93.80
## 7  7     95.05
## 8  8     95.92</code></pre>
<pre class="r"><code># Change column names:

colnames(alt_scree2) &lt;- c(&quot;k&quot;, &quot;Total_Var&quot;)

# Scree ggplot plot:
ggplot(alt_scree2, aes(x = k, y = total_var)) + geom_point() + geom_line() + 
  labs(x = &quot;\n Number Of Clusters (k)&quot;, y = &quot;Total Variance (Percent) \n&quot;, 
       title = &quot;Determining The Optimal Number Of Clusters \n&quot;) + 
  theme(plot.title = element_text(hjust = 0.5), 
        axis.title.x = element_text(face=&quot;bold&quot;, colour = &quot;darkgreen&quot;, size = 12),
        axis.title.y = element_text(face=&quot;bold&quot;, colour = &quot;darkgreen&quot;, size = 12),
        legend.title = element_text(face=&quot;bold&quot;, size = 10))</code></pre>
<p><img src="rmachine-kmeans01_files/figure-html/unnamed-chunk-14-1.png" width="432" /></p>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
