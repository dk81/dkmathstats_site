<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>Data Manipulation In R Using The dplyr Package</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />

</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 60px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 65px;
  margin-top: -65px;
}

.section h2 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h3 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h4 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h5 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h6 {
  padding-top: 65px;
  margin-top: -65px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->






<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">dkmathstats Website</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="about.html">About</a>
</li>
<li>
  <a href="mathstats_pages.html">Math &amp; Stats Pages</a>
</li>
<li>
  <a href="r-projects.html">R Programming</a>
</li>
<li>
  <a href="python_projects.html">Python Programming</a>
</li>
<li>
  <a href="toronto_math_tutoring.html">Math Tutoring In Toronto Area</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Data Manipulation In R Using The dplyr Package</h1>

</div>


<p> </p>
<p>Hello. In this page, I experiment with data manipulation and extracting information from data using the <code>dplyr</code> package in the statistical program R. Here is my guide to dplyr and R.</p>
<p> </p>
<div id="table-of-contents" class="section level3">
<h3><u>Table Of Contents</u></h3>
<p> </p>
<ul>
<li><a href="#what">What Is The dplyr Package in R?</a></li>
<li><a href="#five">Five Main Functions In The dplyr R Package</a></li>
<li><a href="#dataset">An Example of dplyr In R - The Dataset</a></li>
<li><a href="#import">Importing the Dataset</a></li>
<li><a href="#dplyr">Using the dplyr Functions In R</a></li>
<li><a href="#pipe">The %&gt;% Pipe Operator In dplyr</a></li>
<li><a href="#refs">References</a></li>
</ul>
<p><a name="what"></a></p>
<p> </p>
</div>
<div id="what-is-the-dplyr-package-in-r" class="section level3">
<h3><u>What Is The dplyr Package in R?</u></h3>
<p> </p>
<p>The <code>dplyr</code> package in R allows the user to transform and summarize data from data sets and data frames. In a sense, the <code>dplyr</code> package is somewhat similar to SQL. In SQL, queries are used to extract information from data tables while dplyr extracts information from data sets.</p>
<p><code>dplyr</code> can also be used on large datasets as well.</p>
<p><a name="five"></a></p>
<p> </p>
</div>
<div id="five-main-functions-in-the-dplyr-r-package" class="section level3">
<h3><u>Five Main Functions In The dplyr R Package</u></h3>
<p> </p>
<p>In the dplyr package there are five main functions for transforming the data and for extracting information from the data.</p>
<p> </p>
<ul>
<li>filter() for extracting rows which meet a criteria</li>
<li>select() for selecting/subsetting columns</li>
<li>summarise() for extracting information about the dataset (e.g. average)</li>
<li>mutate() for making new variables/columns in the dataset</li>
<li>group_by() for grouping data into rows</li>
</ul>
<p> </p>
<p>There are other more functions in the dplyr package, but these 5 are the more important ones.</p>
<p><a name="dataset"></a></p>
<p> </p>
</div>
<div id="an-example-of-dplyr-in-r---the-dataset" class="section level3">
<h3><u>An Example of dplyr In R - The Dataset</u></h3>
<p> </p>
<p>The poisons dataset is being used and the information is from from <a href="https://vincentarelbundock.github.io/Rdatasets/doc/boot/poisons.html" class="uri">https://vincentarelbundock.github.io/Rdatasets/doc/boot/poisons.html</a>.</p>
<p>The data is a result from an experiment on animals with three poisons and four treatments.</p>
<p> </p>
<p><strong>Variables</strong></p>
<p>time: The survival time of the animal in units of 10 hours</p>
<p>poison: A factor with levels of 1, 2, 3 depending on the poison type being used</p>
<p>treat: A factor with levels of A, B, C and D based on the treatment type.</p>
<p><a name="import"></a></p>
<p> </p>
</div>
<div id="importing-the-dataset" class="section level3">
<h3><u>Importing the Dataset</u></h3>
<p> </p>
<p>If the <code>dplyr</code> package in R is not installed into the system, one can install dplyr into R using the command:</p>
<p> </p>
<pre><code>install.packages(&quot;dplyr&quot;)</code></pre>
<p> </p>
<p>To enable the dplyr package and its commands (such as filter, summarise), type in:</p>
<p> </p>
<pre class="r"><code>library(dplyr)</code></pre>
<p> </p>
<p>In the next steps, the url website address is stored into the url variable and we import and read the url as a comma separated value file (.csv) into R. This imported .csv file is converted to a data frame and stored into the animal_surv variable.</p>
<p> </p>
<pre class="r"><code>url &lt;- &quot;https://vincentarelbundock.github.io/Rdatasets/csv/boot/poisons.csv&quot;

animal_surv &lt;- data.frame(read.csv(url, header = TRUE))</code></pre>
<p> </p>
<p>After importing the data, we take a look at the data using the <code>head()</code>, <code>tail()</code> and <code>summary()</code> functions in R.</p>
<p> </p>
<pre class="r"><code>head(animal_surv)</code></pre>
<pre><code>##   X time poison treat
## 1 1 0.31      1     A
## 2 2 0.45      1     A
## 3 3 0.46      1     A
## 4 4 0.43      1     A
## 5 5 0.36      2     A
## 6 6 0.29      2     A</code></pre>
<pre class="r"><code>tail(animal_surv)</code></pre>
<pre><code>##     X time poison treat
## 43 43 0.71      2     D
## 44 44 0.38      2     D
## 45 45 0.30      3     D
## 46 46 0.36      3     D
## 47 47 0.31      3     D
## 48 48 0.33      3     D</code></pre>
<pre class="r"><code>summary(animal_surv)</code></pre>
<pre><code>##        X              time            poison  treat 
##  Min.   : 1.00   Min.   :0.1800   Min.   :1   A:12  
##  1st Qu.:12.75   1st Qu.:0.3000   1st Qu.:1   B:12  
##  Median :24.50   Median :0.4000   Median :2   C:12  
##  Mean   :24.50   Mean   :0.4794   Mean   :2   D:12  
##  3rd Qu.:36.25   3rd Qu.:0.6225   3rd Qu.:3         
##  Max.   :48.00   Max.   :1.2400   Max.   :3</code></pre>
<p> </p>
<p>The <code>head()</code> function looks at the top 6 rows (by default) of the dataset. The <code>tail()</code> function is like the <code>head()</code> function but it looks at the bottom 6 rows (by default). The <code>summary()</code> function looks at the dataset and outputs the minimum, median, mean , maximum, first quartile and third quartile for each variable (column).</p>
<p>One could point out that there is this X column which is not needed. We can fix this by removing the first column of the dataset as follows.</p>
<p> </p>
<pre class="r"><code>animal_surv &lt;- animal_surv[, -1]

head(animal_surv)</code></pre>
<pre><code>##   time poison treat
## 1 0.31      1     A
## 2 0.45      1     A
## 3 0.46      1     A
## 4 0.43      1     A
## 5 0.36      2     A
## 6 0.29      2     A</code></pre>
<p><a name="dplyr"></a></p>
<p> </p>
</div>
<div id="using-the-dplyr-functions-in-r" class="section level3">
<h3><u>Using the dplyr Functions In R</u></h3>
<p> </p>
<p>We now have the data ready for analysis. Some of the dplyr functions will be used here as reference and as examples.</p>
<p>Instead of looking at the first or last rows of data, we can use the <code>sample_n()</code> function.</p>
<p> </p>
<p><strong>sample_n()</strong></p>
<p> </p>
<pre class="r"><code>## sample_n Function From dplyr:
## Randomly select ten rows and view

sample_n(animal_surv, 10, replace = FALSE)</code></pre>
<pre><code>##    time poison treat
## 31 0.31      2     C
## 15 0.88      1     B
## 12 0.23      3     A
## 18 0.61      2     B
## 16 0.72      1     B
## 13 0.82      1     B
## 10 0.21      3     A
## 23 0.38      3     B
## 8  0.23      2     A
## 1  0.31      1     A</code></pre>
<p> </p>
<hr />
<p> </p>
<p><strong>select()</strong></p>
<p> </p>
<p>Suppose we want just the poison and time columns and not treat. There are two ways to do this.</p>
<p> </p>
<pre class="r"><code># Select rows with poison and times (2 ways):

head(select(animal_surv, time, poison))</code></pre>
<pre><code>##   time poison
## 1 0.31      1
## 2 0.45      1
## 3 0.46      1
## 4 0.43      1
## 5 0.36      2
## 6 0.29      2</code></pre>
<pre class="r"><code>head(select(animal_surv, -(treat)))</code></pre>
<pre><code>##   time poison
## 1 0.31      1
## 2 0.45      1
## 3 0.46      1
## 4 0.43      1
## 5 0.36      2
## 6 0.29      2</code></pre>
<p> </p>
<p>For illustration purposes, the <code>head()</code> function was used to show this output. For the full select output remove the <code>head()</code> function.</p>
<p> </p>
<hr />
<p><strong>filter()</strong></p>
<p> </p>
<p>The filter function extracts rows which meet a logical criteria. Here is an example.</p>
<p> </p>
<pre class="r"><code># Select poison column of data:
filter(animal_surv, poison == 1)</code></pre>
<pre><code>##    time poison treat
## 1  0.31      1     A
## 2  0.45      1     A
## 3  0.46      1     A
## 4  0.43      1     A
## 5  0.82      1     B
## 6  1.10      1     B
## 7  0.88      1     B
## 8  0.72      1     B
## 9  0.43      1     C
## 10 0.45      1     C
## 11 0.63      1     C
## 12 0.76      1     C
## 13 0.45      1     D
## 14 0.71      1     D
## 15 0.66      1     D
## 16 0.62      1     D</code></pre>
<p> </p>
<hr />
<p><strong>summarise()</strong></p>
<p> </p>
<p>The <code>summarise()</code> function in dplyr summarises the data into a single row of values. There are two examples below.</p>
<p> </p>
<pre class="r"><code># Summarise data: Mean of the times:
summarise(animal_surv, mean_times = mean(time));</code></pre>
<pre><code>##   mean_times
## 1   0.479375</code></pre>
<p> </p>
<hr />
<p><strong>group_by()</strong></p>
<p> </p>
<p>The second example uses the <code>summarise()</code> function along with the <code>group_by()</code> dplyr function. In this second example, the mean times are taken and are grouped by each poison type.</p>
<p> </p>
<pre class="r"><code># Mean of survival times grouped/categorized by poision:
summarise(group_by(animal_surv, poison), mean_time_poison = mean(time))</code></pre>
<pre><code>## # A tibble: 3 x 2
##   poison mean_time_poison
##    &lt;int&gt;            &lt;dbl&gt;
## 1      1         0.617500
## 2      2         0.544375
## 3      3         0.276250</code></pre>
<p><a name="pipe"></a></p>
<p> </p>
</div>
<div id="the-pipe-operator-in-dplyr" class="section level3">
<h3><u>The %&gt;% Pipe Operator In dplyr</u></h3>
<p> </p>
<p>Notice how in each command, the first argument was the dataset <code>animal_surv</code>. There is a way such that we do not have to type the dataset out every time.</p>
<p>The <code>%&gt;%</code> pipe operator allows us to condense the amount of code and acts as a “and then” operator. Here are a few examples.</p>
<pre class="r"><code># Select poison column of data (without %&gt;%)

filter(animal_surv, poison == 1)</code></pre>
<pre><code>##    time poison treat
## 1  0.31      1     A
## 2  0.45      1     A
## 3  0.46      1     A
## 4  0.43      1     A
## 5  0.82      1     B
## 6  1.10      1     B
## 7  0.88      1     B
## 8  0.72      1     B
## 9  0.43      1     C
## 10 0.45      1     C
## 11 0.63      1     C
## 12 0.76      1     C
## 13 0.45      1     D
## 14 0.71      1     D
## 15 0.66      1     D
## 16 0.62      1     D</code></pre>
<pre class="r"><code># With operator:

animal_surv %&gt;% filter(poison == 1)</code></pre>
<pre><code>##    time poison treat
## 1  0.31      1     A
## 2  0.45      1     A
## 3  0.46      1     A
## 4  0.43      1     A
## 5  0.82      1     B
## 6  1.10      1     B
## 7  0.88      1     B
## 8  0.72      1     B
## 9  0.43      1     C
## 10 0.45      1     C
## 11 0.63      1     C
## 12 0.76      1     C
## 13 0.45      1     D
## 14 0.71      1     D
## 15 0.66      1     D
## 16 0.62      1     D</code></pre>
<pre class="r"><code># Earlier we had the mean of survival times grouped/categorized by poison:
summarise(group_by(animal_surv, poison), mean_time_poison = mean(time))</code></pre>
<pre><code>## # A tibble: 3 x 2
##   poison mean_time_poison
##    &lt;int&gt;            &lt;dbl&gt;
## 1      1         0.617500
## 2      2         0.544375
## 3      3         0.276250</code></pre>
<pre class="r"><code>### More readable code of above using the pipe operator %&gt;%:

animal_surv %&gt;% group_by(poison) %&gt;% summarise(mean_time_poison = mean(time))</code></pre>
<pre><code>## # A tibble: 3 x 2
##   poison mean_time_poison
##    &lt;int&gt;            &lt;dbl&gt;
## 1      1         0.617500
## 2      2         0.544375
## 3      3         0.276250</code></pre>
<p> </p>
<p>In the first example, the <code>animal_surv</code> variable is passed as the first argument in <code>filter()</code> using the <code>%&gt;%</code> pipe operator.</p>
<p>With the second example, the animal_surv variable is passed as the first argument in <code>group_by()</code> and then the <code>group_by(poison)</code> is passed as the first argument in summarise. The dataset animal_surv is implied in summrise too.</p>
<p>The output for the above commands are ommitted to save space here.</p>
<p>Another example of the pipe operator and the <code>filter()</code> function is this one below.</p>
<p> </p>
<pre class="r"><code># Filter function (Treatment D is bad):

animal_surv %&gt;% filter(treat != &quot;D&quot;)</code></pre>
<pre><code>##    time poison treat
## 1  0.31      1     A
## 2  0.45      1     A
## 3  0.46      1     A
## 4  0.43      1     A
## 5  0.36      2     A
## 6  0.29      2     A
## 7  0.40      2     A
## 8  0.23      2     A
## 9  0.22      3     A
## 10 0.21      3     A
## 11 0.18      3     A
## 12 0.23      3     A
## 13 0.82      1     B
## 14 1.10      1     B
## 15 0.88      1     B
## 16 0.72      1     B
## 17 0.92      2     B
## 18 0.61      2     B
## 19 0.49      2     B
## 20 1.24      2     B
## 21 0.30      3     B
## 22 0.37      3     B
## 23 0.38      3     B
## 24 0.29      3     B
## 25 0.43      1     C
## 26 0.45      1     C
## 27 0.63      1     C
## 28 0.76      1     C
## 29 0.44      2     C
## 30 0.35      2     C
## 31 0.31      2     C
## 32 0.40      2     C
## 33 0.23      3     C
## 34 0.25      3     C
## 35 0.24      3     C
## 36 0.22      3     C</code></pre>
<p> </p>
<hr />
<p><strong>mutate()</strong></p>
<p> </p>
<p>Suppose we want to add a new column/variable to our dataset. This new variable answers the question “Does the case have more than 1 hour of survival time?”</p>
<p>We use the <code>mutate()</code> function to add a new column given an equation or a criteria.</p>
<p> </p>
<pre class="r"><code># Mutate function and adding a column to the dataset. Does the case have more than 1 hour
# of survival time?:

new_data &lt;- mutate(animal_surv, one_hour_plus = time &gt; 1)</code></pre>
<p> </p>
<p>From the new dataset with the extra column we can extract information from it.</p>
<p> </p>
<pre class="r"><code># See data with times over an hour (2 ways):

new_data %&gt;% filter(one_hour_plus == TRUE)</code></pre>
<pre><code>##   time poison treat one_hour_plus
## 1 1.10      1     B          TRUE
## 2 1.24      2     B          TRUE
## 3 1.02      2     D          TRUE</code></pre>
<pre class="r"><code>animal_surv %&gt;% filter(time &gt; 1)</code></pre>
<pre><code>##   time poison treat
## 1 1.10      1     B
## 2 1.24      2     B
## 3 1.02      2     D</code></pre>
<p><a name="refs"></a></p>
<p> </p>
</div>
<div id="references" class="section level3">
<h3><u>References</u></h3>
<p> </p>
<p>The featured image is from <a href="https://www.rstudio.com/wp-content/uploads/2014/06/RStudio-Ball.png" class="uri">https://www.rstudio.com/wp-content/uploads/2014/06/RStudio-Ball.png</a>.</p>
<p>This introductory tutorial on the dplyr package is helpful as well.</p>
<p>The Datacamp course on using dplyr is helpful too.</p>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
