---
title: "Creating Multiple Random Walks In R"
output: html_document
---

&nbsp;

Hi there. This is a follow up to my page on Random Walks In R. The previous page was about generating a single random walk path and plotting it. In this page, the focus is on creating on multiple random walk paths.

&nbsp;

### <u>Sections</u>

&nbsp;

<a href="#rwalks">The Code For Multiple Random Walks In R</a>

<a href="#plot">Random Walk Paths Plot</a>

<a href="#replicate">Alternate Way By Using The replicate() Function</a>

<a href="#refs">References</a>

&nbsp;

<a name="rwalks"></a>

### <u>The Code For Multiple Random Walks In R</u>

&nbsp;

Create one random walk path is not too bad. When it comes to simulating multiple random walk paths, it gets somewhat tricky.

I first initialize some values such as the time and the number of random walk paths I want to simulate. In this example, I choose 8 for num_paths.

I also initialize my matrix full of zeroes with the number of rows equal to the number of paths and the number of columns being the time + 1 (I have to include the time at t = 0).

Using a for loop, I simulate the positions at each time point for each path. The for loop will start with the first path and go through all the time points and then it goes to the second path and so on.

&nbsp;

```{r}
# Multiple Random Walk Paths:

# Resource: http://www.phytools.org/eqg/Exercise_4.1/
# https://stackoverflow.com/questions/17150183/plot-multiple-lines-in-one-graph

library(ggplot2)

# Using the cumsum() function to generate random walk more efficently:

time <- 100
num_paths <- 8

rw_paths <- matrix(data = 0, nrow = num_paths, ncol = time + 1)

# Fill rows with each random walk path realization:

for (i in 1:num_paths){
   rw_paths[i, ] <- c(0, cumsum(sample(x = c(-1, 1), size = time, prob = c(0.5, 0.5), replace = TRUE)))
}

rw_paths <- data.frame(rw_paths)

# Check:

head(rw_paths)
```

&nbsp;

From the check of `head(rw_paths)`, we have a wide formatted data set:

```{r}
# Check:

head(rw_paths)

```

&nbsp;


Instead of this wide format, I would like the time points as rows and the paths going down by column. In R, I add a time = 0 column and I transpose this wide format into a long format. (Transpose comes from linear algebra which means to switch rows with columns and vice versa.)

&nbsp;

```{r}
# Transpose and add times column (Transpose = switch rows with columns and viceversa):

rw_paths_t <- cbind(Time = 0:time, t(rw_paths))

head(rw_paths_t)
```

&nbsp;

The columns after Time have no titles. This can be fixed easily. I also remove the row names with the X1, X2, etc.

&nbsp;

```{r}
# Rename columns: Each column represents the path and the values are the positions at time t:

for (i in 1:num_paths){
  colnames(rw_paths_t)[i + 1] <- paste0("Path_", i)
}

# Remove row names, have them blank

rownames(rw_paths_t) <- NULL


# Convert to data.frame for gather().

rw_paths_t <- data.frame(rw_paths_t)
```

&nbsp;

Here is another check.

&nbsp;

```{r}
head(rw_paths_t)
```

&nbsp;

This table looks nice and can be easily read. The downside of it is that it's not usable for plotting in ggplot2. I want to reformat the data from a wide format to a long format where I have a column stating which path the position value goes with at each time point.

To do this, I use `tidyr`. (dplyr is used for the %>% pipe operator).

&nbsp;

```{r}
# Wide Format To Long Format Data:

library(tidyr)
library(dplyr)

rw_paths2 <- rw_paths_t %>% gather(Path, Position, -Time)

# Check:

head(rw_paths2)
```

&nbsp;

In the `gather()` function from tidyr, I leave the time column alone. The Path_1, Path_2 up to Path_8 column names are now values under the new Path column. The values under Path_1, Path_2 up to Path_8 are now values in this new column called Position. These values correspond to the Path value and to the time point.


&nbsp;

<a name="plot"></a>

### <u>Random Walk Paths Plot</u>

&nbsp;

After generating our random walk paths and data formatting, the random walk paths can be plotted in R with ggplot2.

&nbsp;

```{r, echo = TRUE, fig.width=4, fig.height=4}
# Ggplot with time on horizontal axis, and running total/position on vertical axis.

ggplot(rw_paths2, aes(x = Time, y = Position, group = Path)) + 
  geom_line() +
  labs(x = "\n Time (Seconds)", y = "Position \n", title = paste0("Random Walk Paths With ", time, " Steps \n")) + 
  theme(plot.title = element_text(hjust = 0.5), 
        axis.title.x = element_text(face="bold", colour="blue", size = 12),
        axis.title.y = element_text(face="bold", colour="blue", size = 12)) +
  geom_hline(yintercept = 0, colour = "red", linetype = "dashed")
```

&nbsp;

For different coloured paths add in `colour = Path` in the `aes()` part in `ggplot()`.

&nbsp;

```{r, echo = TRUE, fig.width=4, fig.height=4}
# If I want different colours for each path I would add colour = Path in aes().

ggplot(rw_paths2, aes(x = Time, y = Position, group = Path, colour = Path)) + 
  geom_line() +
  labs(x = "\n Time (Seconds)", y = "Position \n", title = paste0("Random Walk Paths With ", time, " Steps \n")) + 
  theme(plot.title = element_text(hjust = 0.5), 
        axis.title.x = element_text(face="bold", colour="blue", size = 12),
        axis.title.y = element_text(face="bold", colour="blue", size = 12)) +
  geom_hline(yintercept = 0, colour = "red", linetype = "dashed")
```

&nbsp;

<a name="replicate"></a>

### <u>Alternate Way By Using The replicate() Function</u>

&nbsp;

Instead of using a for loop for generating multiple random walk paths, the `replicate()` function can be used.

To show how `replicate()` works, here is an example. I use the `replicate()` function to simulate 8 standard uniform random variables 10 times.

Each of the ten replications are in columns.

The R code for multiple random walks is pretty similar to the one in the previous section. The for loop section has been modified for the `replicate()` function.

&nbsp;

```{r, echo = TRUE, fig.width=4, fig.height=4}
# Replicate example: replicate(n = 10, runif(n = 8))

# Replicate function version:

library(ggplot2)

# Using the cumsum() function to generate random walk more efficently:

time <- 100
num_paths <- 8

rw_paths <- matrix(data = 0, nrow = time + 1, ncol = num_paths)
 
# Fill rows with each random walk path realization with replicate():

rw_paths <- replicate(num_paths, c(0, cumsum(sample(x = c(-1, 1), size = time, prob = c(0.5, 0.5), replace = TRUE))))

rw_paths <- data.frame(rw_paths)

# Check:
 
head(rw_paths)

# Add times column (No need to transpose here):

rw_paths <- cbind(Time = 0:time, rw_paths)

head(rw_paths)
```

&nbsp;

The neat part with replicate is that there is no need to transpose this time around. Here is the rest of the code before plotting. (This code section is pretty much the same as before.)

&nbsp;

```{r, echo = TRUE, fig.width=4, fig.height=4} 
# Rename columns: p_t which is position at time t.

for (i in 1:num_paths){
  colnames(rw_paths)[i + 1] <- paste0("Path_", i)
}

# Remove row names, have them blank

rownames(rw_paths) <- NULL

# Convert to data.frame for gather().

rw_paths <- data.frame(rw_paths)

# Wide Format To Long Format Data:

library(tidyr)
library(dplyr)

rw_paths2 <- rw_paths %>% gather(Path, Position, -Time)

# Check:

head(rw_paths2)
 
tail(rw_paths2)

dim(rw_paths2)
```

&nbsp;

Here is the code and output of the plots.

&nbsp;

```{r, echo = TRUE, fig.width=4, fig.height=4}
# Ggplot with time on horizontal axis, and running total/position on vertical axis.

ggplot(rw_paths2, aes(x = Time, y = Position, group = Path)) + 
  geom_line() +
  labs(x = "\n Time (Seconds)", y = "Position \n", title = paste0("Random Walk Paths With ", time, " Steps \n")) + 
  theme(plot.title = element_text(hjust = 0.5), 
        axis.title.x = element_text(face="bold", colour="blue", size = 12),
        axis.title.y = element_text(face="bold", colour="blue", size = 12)) +
  geom_hline(yintercept = 0, colour = "red", linetype = "dashed")

# If I want different colours for each path I would add colour = Path in aes().

ggplot(rw_paths2, aes(x = Time, y = Position, group = Path, colour = Path)) + 
  geom_line() +
  labs(x = "\n Time (Seconds)", y = "Position \n", title = paste0("Random Walk Paths With ", time, " Steps \n")) + 
  theme(plot.title = element_text(hjust = 0.5), 
        axis.title.x = element_text(face="bold", colour="blue", size = 12),
        axis.title.y = element_text(face="bold", colour="blue", size = 12)) +
  geom_hline(yintercept = 0, colour = "red", linetype = "dashed")
```


&nbsp;

<a name="refs"></a>

### <u>References</u>

&nbsp;

* http://www.phytools.org/eqg/Exercise_4.1/
* https://stackoverflow.com/questions/17150183/plot-multiple-lines-in-one-graph
* Hands-On Programming With R By Garrett Grolemund